<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- headlinks removed -->
	<link rel="shortcut icon" href="../../../../misc/favicon.ico"/>
    <title>ELPA - ESL - The Electronic Structure Library
</title>
    <style type="text/css">/*<![CDATA[*/ @import "../../../../skins/offline/main.css"; /*]]>*/</style>
    <link rel="stylesheet" type="text/css" media="print" href="../../../../skins/common/commonPrint.css" />
    <!--[if lt IE 5.5000]><style type="text/css">@import "../../../../skins/monobook/IE50Fixes.css";</style><![endif]-->
    <!--[if IE 5.5000]><style type="text/css">@import "../../../../skins/monobook/IE55Fixes.css";</style><![endif]-->
    <!--[if IE 6]><style type="text/css">@import "../../../../skins/monobook/IE60Fixes.css";</style><![endif]-->
    <!--[if IE]><script type="text/javascript" src="../../../../skins/common/IEFixes.js"></script>
    <meta http-equiv="imagetoolbar" content="no" /><![endif]-->
    <script type="text/javascript" src="../../../../skins/common/wikibits.js"></script>
    <script type="text/javascript" src="../../../../skins/offline/md5.js"></script>
    <script type="text/javascript" src="../../../../skins/offline/utf8.js"></script>
    <script type="text/javascript" src="../../../../skins/offline/lookup.js"></script>
                      </head>
  <body class="mediawiki ltr ns-0 ns-subject page-ELPA">
    <div id="globalWrapper">
      <div id="column-content">
	<div id="content">
	  <a name="top" id="contentTop"></a>
	        <h1 class="firstHeading">ELPA</h1>
	  <div id="bodyContent">
	    <h3 id="siteSub">From ESL</h3>
	    <div id="contentSub"></div>
	    	    	    <!-- start content -->
	    <div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div style="float: right; background: AliceBlue; padding: 10px; margin-left: 10px; margin-bottom: 10px; border-style: solid; border-width: 1px; width: 35%">
<p><b>Source authors:</b>
</p><p><a rel="nofollow" target="_blank" class="external text" href="http://elpa.rzg.mpg.de/">ELPA Consortium</a> (external homepage)
</p><p><b>Responsible for the ESL entry:</b>
</p><p><a href="http://esl.cecam.org/mediawiki/index.php?title=User:Jan.kloppenburg&amp;action=edit&amp;redlink=1" class="new" title="User:Jan.kloppenburg (page does not exist)">J. Kloppenburg</a> (wiki user page)
</p><p><b>License:</b> <a rel="nofollow" target="_blank" class="external text" href="https://www.gnu.org/copyleft/lesser.html/">LGPL</a>
</p><p><b>Type of development:</b> External
</p><p><b>Download:</b> <a rel="nofollow" target="_blank" class="external text" href="http://elpa.rzg.mpg.de/">download</a> tar.gz here]
</p>
</div>
<p><b>ELPA: Eigenvalue SoLver for Petaflop Applications</b>
</p><p>ELPA is a Fortran-based high-performance computational library for the massively parallel solution of symmetric or Hermitian, standard or generalized eigenvalue problems.
</p><p>On a single core there are standard libraries available that implement the usual mathematical way to solve the problem numerically. For massively parallel supercomputer applications this problem is non-trivial because of the neccassary communication involved. The ELPA library was developed to improve performance of already existing implementations which are available in scalapack which is also distributed by the <a rel="nofollow" target="_blank" class="external text" href="http://www.netlib.org">netlib</a> website that provides lapack among many other numerical libraries.<br />
The original ELPA Library was created by the <a rel="nofollow" target="_blank" class="external text" href="http://elpa.rzg.mpg.de/">ELPA</a> consortium, a collaborative effort supported by the German Federal Ministry of Education and Research <a rel="nofollow" target="_blank" class="external text" href="http://www.bmbf.de/en/">BMBF</a>, grant number 01IH08007.
</p>
<table align="right">
<tr>
<td><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Publications"><span class="tocnumber">1</span> <span class="toctext">Publications</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Prerequisites"><span class="tocnumber">2</span> <span class="toctext">Prerequisites</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Installation"><span class="tocnumber">3</span> <span class="toctext">Installation</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Testing"><span class="tocnumber">4</span> <span class="toctext">Testing</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Interface_descriptions"><span class="tocnumber">5</span> <span class="toctext">Interface descriptions</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#References"><span class="tocnumber">6</span> <span class="toctext">References</span></a></li>
</ul>
</div>

</td></tr></table>
<h2><span class="mw-headline" id="Publications">Publications</span></h2>
<p>The latest publication concerning ELPA can be found here
<sup id="cite_ref-1" class="reference"><a href="#cite_note-1">[1]</a></sup>.
</p>
<h2><span class="mw-headline" id="Prerequisites">Prerequisites</span></h2>
<p>The lapack and scalapack libraries from the <a rel="nofollow" target="_blank" class="external text" href="http://www.netlib.org">netlib</a> website are a minimal requirement. If you decide to use the Intel compilers you do not need an extra lapack+scalapack library since the Intel MKL is included in the usual distribution from Intel. Make sure to install the MKL scalapack librarires by selecting the 'cluster tools' option during the installation of Intel compilers since they are no longer installed automatically with versions 14+.
</p>
<h2><span class="mw-headline" id="Installation">Installation</span></h2>
<p><b>1) GCC:</b>
</p>
<pre> a) Get the lapack and scalapack packages from <a rel="nofollow" target="_blank" class="external text" href="http://www.netlib.org">netlib</a> and install them into $YOUR_DIRECTORY.
 b) In the console where you intend to build ELPA, enter export LIBS='-L$YOUR_DIRECTORY -lscalapack -llapack -lblas' and &lt;Enter&gt; it.
 c) Extract ELPA archive, a subdirectory containing the files will be created.
 d) Do ./configure --help and READ the options about kernels to build with ELPA, this choice will not be made for you, the most general choice 
 is the generic kernel but there are also assembler code versions available for SSE, AVX and BG architectures.
 e) ./configure --prefix=&lt;INSTALL_DIR&gt; --kernel_of_choice --disable-shared
 f) make &amp;&amp; make install
 g) For the linking of your program to use ELPA, remember to add the linking flags. The most easy way would be to add the library specification
 '-L&lt;INSTALL_DIR&gt; -lelpa' to the final link line of your program source code build architecture. 
</pre>
<p><b>2) Intel:</b>
</p>
<pre> a) Extract ELPA archive, a subdirectory containing the files will be created.
 b) Do ./configure --help and READ the options about kernels to build with ELPA, this choice will not be made for you, the most general choice
 is the generic kernel but there are also assembler code versions available for SSE, AVX and BG architectures.
 c) ./configure --prefix=&lt;INSTALL_DIR&gt; --kernel_of_choice 
 d) make &amp;&amp; make install
 e) For the linking of your program to use ELPA, remember to add the linking flags. The most easy way would be to add the library specification
 '-L&lt;INSTALL_DIR&gt; -lelpa' to the final link line of your program source code build architecture.
</pre>
<h2><span class="mw-headline" id="Testing">Testing</span></h2>
<p>With the usual installation of ELPA there will be small testing programs installed. They are called test_complex, test_complex2, test_real and test_real2, named by thier functionality. ELPA has a one-stage and a two-stage functionality and real and complex variable inputs/outputs and so the program names reflect the test to be run. 
</p><p>One of these will be used here for illustrative purposes. The original file in the distribution contains some more functionality that has been removed here because it it not needed for demonstration purposes.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> <span class="kw1">program</span> test_real2
 <span class="kw3">use</span> ELPA1
 <span class="kw3">use</span> ELPA2</pre></div></div>
<p>We define the name of the program and include the two ELPA libraries.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> <span class="kw3">implicit</span> <span class="kw3">none</span>
 include <span class="st0">'mpif.h'</span></pre></div></div>
<p>Make sure variable name typos are recognized as such and include the mpi fortran header which ELPA needs to set default values.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> <span class="kw3">integer</span> <span class="sy0">::</span> <span class="me2">nblk</span>
 <span class="kw3">integer</span> na, nev
 <span class="kw3">integer</span> np_rows, np_cols, na_rows, na_cols
 <span class="kw3">integer</span> myid, nprocs, my_prow, my_pcol, mpi_comm_rows, mpi_comm_cols
 <span class="kw3">integer</span> i, mpierr, my_blacs_ctxt, sc_desc<span class="br0">&#40;</span><span class="nu0">9</span><span class="br0">&#41;</span>, info, nprow, npcol
 <span class="kw3">integer</span>, <span class="kw3">external</span> <span class="sy0">::</span> <span class="me2">numroc</span>
 <span class="kw3">real</span><span class="sy0">*</span><span class="nu0">8</span> <span class="kw1">err</span>, errmax
 <span class="kw3">real</span><span class="sy0">*</span><span class="nu0">8</span>, <span class="kw3">allocatable</span> <span class="sy0">::</span> <span class="me2">a</span><span class="br0">&#40;</span><span class="sy0">:</span>,<span class="sy0">:</span><span class="br0">&#41;</span>, z<span class="br0">&#40;</span><span class="sy0">:</span>,<span class="sy0">:</span><span class="br0">&#41;</span>, tmp1<span class="br0">&#40;</span><span class="sy0">:</span>,<span class="sy0">:</span><span class="br0">&#41;</span>, tmp2<span class="br0">&#40;</span><span class="sy0">:</span>,<span class="sy0">:</span><span class="br0">&#41;</span>, as<span class="br0">&#40;</span><span class="sy0">:</span>,<span class="sy0">:</span><span class="br0">&#41;</span>, ev<span class="br0">&#40;</span><span class="sy0">:</span><span class="br0">&#41;</span>
 <span class="kw3">integer</span> <span class="sy0">::</span> <span class="me2">iseed</span><span class="br0">&#40;</span><span class="nu0">4096</span><span class="br0">&#41;</span> <span class="co1">! Random seed, size should be sufficient for every generator</span>
 <span class="kw3">integer</span> <span class="sy0">::</span> <span class="kw1">STATUS</span></pre></div></div>
<p>These are variable declarations as usually expected in source code.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> #ifdef WITH_OPENMP
   <span class="kw3">integer</span> <span class="sy0">::</span> <span class="me2">omp_get_max_threads</span>,  required_mpi_thread_level, provided_mpi_thread_level
 #endif</pre></div></div>
<p>Add some more variables in case we use openmp.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> nblk <span class="sy0">=</span> <span class="nu0">16</span>
 na <span class="sy0">=</span> <span class="nu0">4000</span>
 nev <span class="sy0">=</span> <span class="nu0">1500</span></pre></div></div>
<p>Set standard values for the scalapack block distribution (nblk), the matrix size (na) and the number of eigenvectors of interest (nev).
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1">#ifndef WITH_OPENMP
  <span class="kw1">call</span> mpi_init<span class="br0">&#40;</span>mpierr<span class="br0">&#41;</span>
#else
 required_mpi_thread_level <span class="sy0">=</span> MPI_THREAD_MULTIPLE
 <span class="kw1">call</span> mpi_init_thread<span class="br0">&#40;</span>required_mpi_thread_level, provided_mpi_thread_level, mpierr<span class="br0">&#41;</span>
 <span class="kw1">if</span> <span class="br0">&#40;</span>required_mpi_thread_level <span class="kw2">.<span class="me1">ne</span>.</span> provided_mpi_thread_level<span class="br0">&#41;</span> <span class="kw1">then</span>
   print <span class="sy0">*</span>,<span class="st0">&quot;MPI ERROR: MPI_THREAD_MULTIPLE is not provided on this system &quot;</span>, provided_mpi_thread_level,<span class="st0">&quot; is available&quot;</span>
   <span class="kw1">call</span> <span class="kw1">EXIT</span><span class="br0">&#40;</span><span class="nu0">1</span><span class="br0">&#41;</span>
   <span class="kw1">stop</span>
 <span class="kw1">endif</span>
 #endif</pre></div></div>
<p>More hooks for sanity checks to confirm we use either MPI or OpenMP.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> <span class="kw1">call</span> mpi_comm_rank<span class="br0">&#40;</span>mpi_comm_world,myid,mpierr<span class="br0">&#41;</span>
 <span class="kw1">call</span> mpi_comm_size<span class="br0">&#40;</span>mpi_comm_world,nprocs,mpierr<span class="br0">&#41;</span></pre></div></div>
<p>Initialize the MPI communicators.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> <span class="kw1">STATUS</span> <span class="sy0">=</span> <span class="nu0">0</span>
 #ifdef WITH_OPENMP
   <span class="kw1">if</span> <span class="br0">&#40;</span>myid <span class="kw2">.<span class="me1">eq</span>.</span> <span class="nu0">0</span><span class="br0">&#41;</span> print <span class="sy0">*</span>,<span class="st0">&quot;Threaded version of test program, using &quot;</span>,omp_get_max_threads<span class="br0">&#40;</span><span class="br0">&#41;</span>,<span class="st0">&quot; threads&quot;</span>
 #endif</pre></div></div>
<p>Output for OpemMP thread number in case we use it.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> <span class="kw1">do</span> np_cols <span class="sy0">=</span> <span class="kw4">NINT</span><span class="br0">&#40;</span><span class="kw4">SQRT</span><span class="br0">&#40;</span><span class="kw3">REAL</span><span class="br0">&#40;</span>nprocs<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>,<span class="nu0">2</span>,<span class="sy0">-</span><span class="nu0">1</span>
   <span class="kw1">if</span><span class="br0">&#40;</span><span class="kw4">mod</span><span class="br0">&#40;</span>nprocs,np_cols<span class="br0">&#41;</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="br0">&#41;</span> <span class="kw1">exit</span>
 <span class="kw1">enddo</span></pre></div></div>
<p>Selection of number of processor rows/columns. We try to set up the grid square-like, i.e. start the search for possible
divisors of nprocs with a number next to the square root of nprocs and decrement it until a divisor is found.
At the end of the above loop, nprocs is always divisible by np_cols.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> np_rows <span class="sy0">=</span> nprocs<span class="sy0">/</span>np_cols</pre></div></div>
<p>Determine the number of processor rows.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> <span class="kw1">if</span><span class="br0">&#40;</span>myid<span class="sy0">==</span><span class="nu0">0</span><span class="br0">&#41;</span> <span class="kw1">then</span>
   print <span class="st0">'(a)'</span>,<span class="st0">'Standard eigenvalue problem - REAL version'</span>
   print <span class="st0">'(3(a,i0))'</span>,<span class="st0">'Matrix size='</span>,na,<span class="st0">', Number of eigenvectors='</span>,nev,<span class="st0">', Block size='</span>,nblk
   print <span class="st0">'(3(a,i0))'</span>,<span class="st0">'Number of processor rows='</span>,np_rows,<span class="st0">', cols='</span>,np_cols,<span class="st0">', total='</span>,nprocs
 <span class="kw1">endif</span></pre></div></div>
<p>Let the master CPU state what has just been set up.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> my_blacs_ctxt <span class="sy0">=</span> mpi_comm_world
 <span class="kw1">call</span> BLACS_Gridinit<span class="br0">&#40;</span> my_blacs_ctxt, <span class="st0">'C'</span>, np_rows, np_cols <span class="br0">&#41;</span>
 <span class="kw1">call</span> BLACS_Gridinfo<span class="br0">&#40;</span> my_blacs_ctxt, nprow, npcol, my_prow, my_pcol <span class="br0">&#41;</span></pre></div></div>
<p>Set up BLACS context and MPI communicators. The BLACS context is only necessary for using Scalapack.
For ELPA, the MPI communicators along rows/cols are sufficient, and the grid setup may be done in an arbitrary way as long as it is
consistent (i.e. 0&lt;=my_prow&lt;np_rows, 0&lt;=my_pcol&lt;np_cols and every process has a unique (my_prow,my_pcol) pair).
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> <span class="kw1">call</span> get_elpa_row_col_comms<span class="br0">&#40;</span>mpi_comm_world, my_prow, my_pcol, mpi_comm_rows, mpi_comm_cols<span class="br0">&#41;</span></pre></div></div>
<p>All ELPA routines need MPI communicators for communicating within rows or columns of processes, these are set in get_elpa_row_col_comms.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> na_rows <span class="sy0">=</span> numroc<span class="br0">&#40;</span>na, nblk, my_prow, <span class="nu0">0</span>, np_rows<span class="br0">&#41;</span>
 na_cols <span class="sy0">=</span> numroc<span class="br0">&#40;</span>na, nblk, my_pcol, <span class="nu0">0</span>, np_cols<span class="br0">&#41;</span></pre></div></div>
<p>Determine the necessary size of the distributed matrices, we use the Scalapack tools routine NUMROC for that.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> <span class="kw1">call</span> descinit<span class="br0">&#40;</span> sc_desc, na, na, nblk, nblk, <span class="nu0">0</span>, <span class="nu0">0</span>, my_blacs_ctxt, na_rows, info <span class="br0">&#41;</span></pre></div></div>
<p>Set up a scalapack descriptor for the checks to be performed.
For ELPA the following restrictions hold: The block sizes in both directions must be identical (args 4+5 (nblk)) and the first row and column of the distributed matrix must be on row/col 0/0 (args 6+7)
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> <span class="kw1">allocate</span><span class="br0">&#40;</span>a <span class="br0">&#40;</span>na_rows,na_cols<span class="br0">&#41;</span><span class="br0">&#41;</span>
 <span class="kw1">allocate</span><span class="br0">&#40;</span>z <span class="br0">&#40;</span>na_rows,na_cols<span class="br0">&#41;</span><span class="br0">&#41;</span>
 <span class="kw1">allocate</span><span class="br0">&#40;</span>as<span class="br0">&#40;</span>na_rows,na_cols<span class="br0">&#41;</span><span class="br0">&#41;</span>
 <span class="kw1">allocate</span><span class="br0">&#40;</span>ev<span class="br0">&#40;</span>na<span class="br0">&#41;</span><span class="br0">&#41;</span>
 iseed<span class="br0">&#40;</span><span class="sy0">:</span><span class="br0">&#41;</span> <span class="sy0">=</span> myid
 <span class="kw1">call</span> <span class="kw4">RANDOM_SEED</span><span class="br0">&#40;</span>put<span class="sy0">=</span>iseed<span class="br0">&#41;</span>
 <span class="kw1">call</span> <span class="kw4">RANDOM_NUMBER</span><span class="br0">&#40;</span>z<span class="br0">&#41;</span>
 a<span class="br0">&#40;</span><span class="sy0">:</span>,<span class="sy0">:</span><span class="br0">&#41;</span> <span class="sy0">=</span> z<span class="br0">&#40;</span><span class="sy0">:</span>,<span class="sy0">:</span><span class="br0">&#41;</span>
 <span class="kw1">call</span> pdtran<span class="br0">&#40;</span>na, na,  <span class="nu0">1</span>.<span class="me1">d0</span>, z, <span class="nu0">1</span>, <span class="nu0">1</span>, sc_desc, <span class="nu0">1</span>.<span class="me1">d0</span>, a, <span class="nu0">1</span>, <span class="nu0">1</span>, sc_desc<span class="br0">&#41;</span> <span class="co1">! A = A + Z**T</span>
 <span class="kw1">if</span> <span class="br0">&#40;</span>myid<span class="sy0">==</span><span class="nu0">0</span><span class="br0">&#41;</span> <span class="kw1">then</span>
   print <span class="st0">'(a)'</span>,<span class="st0">'| Random matrix has been symmetrized.'</span>
 <span class="kw1">end</span> <span class="kw1">if</span></pre></div></div>
<p>Allocate matrices and set up a test matrix for the eigenvalue problem. For getting a symmetric test matrix A we get a random matrix Z
and calculate <img class="mwe-math-fallback-png-inline tex" alt="A=Z+Z^{T}" src="../../../../../math/a/5/e/a5eba9625b535c32ff204550ebd81b51.png" />. We want different random numbers on every process (otherways A might get rank deficient):
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> as <span class="sy0">=</span> a</pre></div></div>
<p>Save original matrix A for later accuracy checks
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> <span class="kw1">if</span> <span class="br0">&#40;</span>myid<span class="sy0">==</span><span class="nu0">0</span><span class="br0">&#41;</span> print <span class="st0">'(a)'</span>,<span class="st0">'| Calling two-stage ELPA solver ... '</span>
 <span class="kw1">call</span> solve_evp_real_2stage<span class="br0">&#40;</span>na, nev, a, na_rows, ev, z, na_rows, nblk, mpi_comm_rows, mpi_comm_cols, mpi_comm_world<span class="br0">&#41;</span></pre></div></div>
<p>Calculate eigenvalues/eigenvectors with ELPA and test correctness of result using scalapack routines.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> <span class="kw1">deallocate</span><span class="br0">&#40;</span>a<span class="br0">&#41;</span>
 <span class="kw1">allocate</span><span class="br0">&#40;</span>tmp1<span class="br0">&#40;</span>na_rows,na_cols<span class="br0">&#41;</span><span class="br0">&#41;</span>
 <span class="kw1">call</span> pdgemm<span class="br0">&#40;</span><span class="st0">'N'</span>,<span class="st0">'N'</span>,na,nev,na,<span class="nu0">1</span>.<span class="me1">d0</span>,as,<span class="nu0">1</span>,<span class="nu0">1</span>,sc_desc,z,<span class="nu0">1</span>,<span class="nu0">1</span>,sc_desc,<span class="nu0">0</span>.<span class="me1">d0</span>,tmp1,<span class="nu0">1</span>,<span class="nu0">1</span>,sc_desc<span class="br0">&#41;</span></pre></div></div>
<p><b>1.</b> Residual (maximum of <img class="mwe-math-fallback-png-inline tex" alt="||A\cdot Zi-Zi\cdot EVi||" src="../../../../../math/c/2/b/c2be58b56a490a716b3f266e0740a4a9.png" /> ) and tmp1 =  <img class="mwe-math-fallback-png-inline tex" alt="A\cdot Z" src="../../../../../math/8/1/c/81c7308f784f8a1ef1e4e327cfd38bec.png" /> computed with scalapacks parallel dgemm.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> <span class="kw1">deallocate</span><span class="br0">&#40;</span>as<span class="br0">&#41;</span>
 <span class="kw1">allocate</span><span class="br0">&#40;</span>tmp2<span class="br0">&#40;</span>na_rows,na_cols<span class="br0">&#41;</span><span class="br0">&#41;</span>
 tmp2<span class="br0">&#40;</span><span class="sy0">:</span>,<span class="sy0">:</span><span class="br0">&#41;</span> <span class="sy0">=</span> z<span class="br0">&#40;</span><span class="sy0">:</span>,<span class="sy0">:</span><span class="br0">&#41;</span>
 <span class="kw1">do</span> i<span class="sy0">=</span><span class="nu0">1</span>,nev
   <span class="kw1">call</span> pdscal<span class="br0">&#40;</span>na,ev<span class="br0">&#40;</span>i<span class="br0">&#41;</span>,tmp2,<span class="nu0">1</span>,i,sc_desc,<span class="nu0">1</span><span class="br0">&#41;</span>
 <span class="kw1">enddo</span>
 tmp1<span class="br0">&#40;</span><span class="sy0">:</span>,<span class="sy0">:</span><span class="br0">&#41;</span> <span class="sy0">=</span>  tmp1<span class="br0">&#40;</span><span class="sy0">:</span>,<span class="sy0">:</span><span class="br0">&#41;</span> <span class="sy0">-</span> tmp2<span class="br0">&#40;</span><span class="sy0">:</span>,<span class="sy0">:</span><span class="br0">&#41;</span></pre></div></div>
<p>Compute <img class="mwe-math-fallback-png-inline tex" alt="tmp2=Zi\cdot EVi" src="../../../../../math/7/a/8/7a828bf4129bf5abe04a9e8c00ce94f1.png" /> and <img class="mwe-math-fallback-png-inline tex" alt="tmp1=A\cdot Zi-Zi\cdot EVi" src="../../../../../math/d/3/e/d3e51788f4b82f6fa1bc9ecb8731cb3b.png" /> as needed for testing.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> errmax <span class="sy0">=</span> <span class="nu0">0</span>
 <span class="kw1">do</span> i<span class="sy0">=</span><span class="nu0">1</span>,nev
   <span class="kw1">err</span> <span class="sy0">=</span> <span class="nu0">0</span>
   <span class="kw1">call</span> pdnrm2<span class="br0">&#40;</span>na,<span class="kw1">err</span>,tmp1,<span class="nu0">1</span>,i,sc_desc,<span class="nu0">1</span><span class="br0">&#41;</span>
   errmax <span class="sy0">=</span> <span class="kw4">max</span><span class="br0">&#40;</span>errmax, <span class="kw1">err</span><span class="br0">&#41;</span>
 <span class="kw1">enddo</span></pre></div></div>
<p>Get maximum norm of columns of tmp1
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> <span class="kw1">err</span> <span class="sy0">=</span> errmax
 <span class="kw1">call</span> mpi_allreduce<span class="br0">&#40;</span><span class="kw1">err</span>,errmax,<span class="nu0">1</span>,MPI_REAL8,MPI_MAX,MPI_COMM_WORLD,mpierr<span class="br0">&#41;</span>
 <span class="kw1">if</span><span class="br0">&#40;</span>myid<span class="sy0">==</span><span class="nu0">0</span><span class="br0">&#41;</span> print <span class="sy0">*</span>,<span class="st0">'Error Residual    &#160;:'</span>,errmax
 <span class="kw1">if</span> <span class="br0">&#40;</span>errmax <span class="kw2">.<span class="me1">gt</span>.</span> 5e<span class="sy0">-</span>12<span class="br0">&#41;</span> <span class="kw1">then</span>
   <span class="kw1">status</span> <span class="sy0">=</span> <span class="nu0">1</span>
 <span class="kw1">endif</span></pre></div></div>
<p>Get maximum error norm over all processors and check if errors are below reasonable threshold.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> tmp1 <span class="sy0">=</span> <span class="nu0">0</span>
 <span class="kw1">call</span> pdgemm<span class="br0">&#40;</span><span class="st0">'T'</span>,<span class="st0">'N'</span>,nev,nev,na,<span class="nu0">1</span>.<span class="me1">d0</span>,z,<span class="nu0">1</span>,<span class="nu0">1</span>,sc_desc,z,<span class="nu0">1</span>,<span class="nu0">1</span>,sc_desc,<span class="nu0">0</span>.<span class="me1">d0</span>,tmp1,<span class="nu0">1</span>,<span class="nu0">1</span>,sc_desc<span class="br0">&#41;</span></pre></div></div>
<p><b>2.</b> Eigenvector orthogonality as in <img class="mwe-math-fallback-png-inline tex" alt="tmp1=Z^{T}\cdot Z" src="../../../../../math/6/6/e/66ece671a306c164e1b6607b6b2e82bb.png" />
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> tmp2 <span class="sy0">=</span> <span class="nu0">0</span>
 <span class="kw1">call</span> pdlaset<span class="br0">&#40;</span><span class="st0">'A'</span>,nev,nev,<span class="nu0">0</span>.<span class="me1">d0</span>,<span class="nu0">1</span>.<span class="me1">d0</span>,tmp2,<span class="nu0">1</span>,<span class="nu0">1</span>,sc_desc<span class="br0">&#41;</span></pre></div></div>
<p>Initialize tmp2 to unit matrix.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> tmp1<span class="br0">&#40;</span><span class="sy0">:</span>,<span class="sy0">:</span><span class="br0">&#41;</span> <span class="sy0">=</span>  tmp1<span class="br0">&#40;</span><span class="sy0">:</span>,<span class="sy0">:</span><span class="br0">&#41;</span> <span class="sy0">-</span> tmp2<span class="br0">&#40;</span><span class="sy0">:</span>,<span class="sy0">:</span><span class="br0">&#41;</span>
 <span class="kw1">err</span> <span class="sy0">=</span> <span class="kw4">maxval</span><span class="br0">&#40;</span><span class="kw4">abs</span><span class="br0">&#40;</span>tmp1<span class="br0">&#41;</span><span class="br0">&#41;</span>
 <span class="kw1">call</span> mpi_allreduce<span class="br0">&#40;</span><span class="kw1">err</span>,errmax,<span class="nu0">1</span>,MPI_REAL8,MPI_MAX,MPI_COMM_WORLD,mpierr<span class="br0">&#41;</span>
 <span class="kw1">if</span><span class="br0">&#40;</span>myid<span class="sy0">==</span><span class="nu0">0</span><span class="br0">&#41;</span> print <span class="sy0">*</span>,<span class="st0">'Error Orthogonality:'</span>,errmax
 <span class="kw1">if</span> <span class="br0">&#40;</span>errmax <span class="kw2">.<span class="me1">gt</span>.</span> 5e<span class="sy0">-</span>12<span class="br0">&#41;</span> <span class="kw1">then</span>
    <span class="kw1">status</span> <span class="sy0">=</span> <span class="nu0">1</span>
 <span class="kw1">endif</span></pre></div></div>
<p>Compute <img class="mwe-math-fallback-png-inline tex" alt="tmp1=Z^{T}\cdot Z-\underline {{\mathbf  {1}}}" src="../../../../../math/b/c/e/bce3f9900485125e478ce651ef56eb46.png" /> resulting in the Residual Error Matrix.
Each element of the resulting matrix is checked to be below the threshold of 5E-12.
</p>
<div dir="ltr" class="mw-geshi mw-code mw-content-ltr"><div class="fortran source-fortran"><pre class="de1"> <span class="kw1">deallocate</span><span class="br0">&#40;</span>z<span class="br0">&#41;</span>
 <span class="kw1">deallocate</span><span class="br0">&#40;</span>tmp1<span class="br0">&#41;</span>
 <span class="kw1">deallocate</span><span class="br0">&#40;</span>tmp2<span class="br0">&#41;</span>
 <span class="kw1">deallocate</span><span class="br0">&#40;</span>ev<span class="br0">&#41;</span>
 <span class="kw1">call</span> blacs_gridexit<span class="br0">&#40;</span>my_blacs_ctxt<span class="br0">&#41;</span>
 <span class="kw1">call</span> mpi_finalize<span class="br0">&#40;</span>mpierr<span class="br0">&#41;</span>
 <span class="kw1">call</span> <span class="kw1">EXIT</span><span class="br0">&#40;</span><span class="kw1">STATUS</span><span class="br0">&#41;</span>
 <span class="kw1">end</span> <span class="kw1">program</span></pre></div></div>
<p>Final cleanup and termination statement to please the compiler.
</p>
<h2><span class="mw-headline" id="Interface_descriptions">Interface descriptions</span></h2>
<p>The basic interface to ELPA has been shown above and it is very similar to the ones used in standard scalapack routines. For a more detailed view of the available interfaces of ELPA go to the official documentation page of the <a rel="nofollow" target="_blank" class="external text" href="http://elpa.rzg.mpg.de">ELPA</a> creators at Rechenzentrum Garching in Germany. There is a detailed documentation with all neccessary information provided. 
</p>
<h2><span class="mw-headline" id="References">References</span></h2>
<ol class="references">
<li id="cite_note-1"><span class="mw-cite-backlink"><a href="#cite_ref-1">↑</a></span> <span class="reference-text">
Andreas Marek, Volker Blum, Rainer Johanni, Ville Havu, Bruno Lang, Thomas Auckenthaler, Alexander Heinecke, Hans-Joachim Bungartz, and Hermann Lederer: 
"The ELPA Library - Scalable Parallel Eigenvalue Solutions for Electronic Structure Theory and Computational Science"
The Journal of Physics: Condensed Matter 26, 213102 (2014). <a rel="nofollow" target="_blank" class="external autonumber" href="http://stacks.iop.org/0953-8984/26/213201">[1]</a></span>
</li>
</ol>

<!-- 
NewPP limit report
CPU time usage: 0.252 seconds
Real time usage: 0.291 seconds
Preprocessor visited node count: 365/1000000
Preprocessor generated node count: 892/1000000
Post‐expand include size: 511/2097152 bytes
Template argument size: 220/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 0/100
-->
</div><div class="printfooter">
</div>
	    <div id="catlinks"><div id='catlinks' class='catlinks'><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="http://esl.cecam.org/mediawiki/index.php/Special:Categories" title="Special:Categories">Categories</a>: <ul><li><a href="../../../../articles/e/s/l/Category:ESL_entries.html" title="Category:ESL entries">ESL entries</a></li><li><a href="http://esl.cecam.org/mediawiki/index.php?title=Category:Libraries&amp;action=edit&amp;redlink=1" class="new" title="Category:Libraries (page does not exist)">Libraries</a></li><li><a href="../../../../articles/s/o/l/Category:Solvers.html" title="Category:Solvers">Solvers</a></li></ul></div></div></div>	    <!-- end content -->
	    <div class="visualClear"></div>
	  </div>
	</div>
      </div>
      <div id="column-one">
	<div id="p-cactions" class="portlet">
	  <h5>Views</h5>
	  <ul>
	    <li id="ca-nstab-main"
	       class="selected"	       ><a href="../../../../articles/e/l/p/ELPA.html">Page</a></li><li id="ca-talk"
	       class="new"	       ><a href="http://esl.cecam.org/mediawiki/index.php?title=Talk:ELPA&amp;action=edit&amp;redlink=1">Discussion</a></li><li id="ca-current"
	       	       ><a href="http://esl.cecam.org/mediawiki/index.php/ELPA">Latest revision</a></li>	  </ul>
	</div>
	<div class="portlet" id="p-logo">
	  <a style="background-image: url(../../../../misc/esl_wiki_logo.png);"
	    href="../../../../index.html"
	    title="Main Page"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
		<div class='portlet' id='p-navigation'>
	  <h5>Navigation</h5>
	  <div class='pBody'>
	    <ul>
	    	      <li id="n-mainpage-description"><a href="../../../../index.html">Main page</a></li>
	     	      <li id="n-About-ESL"><a href="../../../../articles/a/b/o/ESL:About.html">About ESL</a></li>
	     	      <li id="n-Contributing"><a href="../../../../articles/c/o/n/Contributing.html">Contributing</a></li>
	     	      <li id="n-Credits"><a href="../../../../articles/c/r/e/Credits.html">Credits</a></li>
	     	      <li id="n-Contact"><a href="../../../../articles/c/o/n/Contact.html">Contact</a></li>
	     	      <li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents">Help</a></li>
	     	    </ul>
	  </div>
	</div>
		<div class='portlet' id='p-SEARCH'>
	  <h5>SEARCH</h5>
	  <div class='pBody'>
	    <ul>
	    	    </ul>
	  </div>
	</div>
		<div class='portlet' id='p-TOOLBOX'>
	  <h5>TOOLBOX</h5>
	  <div class='pBody'>
	    <ul>
	    	    </ul>
	  </div>
	</div>
		<div class='portlet' id='p-LANGUAGES'>
	  <h5>LANGUAGES</h5>
	  <div class='pBody'>
	    <ul>
	    	    </ul>
	  </div>
	</div>
		<div id="p-search" class="portlet">
	  <h5><label for="searchInput">Search</label></h5>
	  <div id="searchBody" class="pBody">
	    <form action="javascript:goToStatic(3)" id="searchform"><div>
	      <input id="searchInput" name="search" type="text"
	        accesskey="f" value="" />
	      <input type='submit' name="go" class="searchButton" id="searchGoButton"
	        value="Go" />
	    </div></form>
	  </div>
	</div>
	      </div><!-- end of the left (by default at least) column -->
      <div class="visualClear"></div>
      <div id="footer">
    <div id="f-poweredbyico"><a href="//www.mediawiki.org/"><img src="../../../../skins/common/images/poweredby_mediawiki_88x31.png" height="31" width="88" alt="Powered by MediaWiki" /></a></div>		<ul id="f-list">
	  	  	  <li id="f-credits">This page was last modified 11:33, 21 July 2014 by <a href="http://esl.cecam.org/mediawiki/index.php?title=User:Jank&amp;action=edit&amp;redlink=1" class="new" title="User:Jank (page does not exist)">Jan Kloppenburg</a>. Based on work by ESL user <a href="http://esl.cecam.org/mediawiki/index.php?title=User:Admin&amp;action=edit&amp;redlink=1" class="new" title="User:Admin (page does not exist)">Admin</a>.</li>	  	  <li id="f-about"><a href="../../../../articles/a/b/o/ESL:About.html" title="ESL:About">About ESL</a></li>	  <li id="f-disclaimer"><a href="../../../../articles/g/e/n/ESL:General_disclaimer.html" title="ESL:General disclaimer">Disclaimers</a></li>	  	</ul>
      </div>
    </div>
  </body>
</html>
